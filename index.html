<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://dimplejs.org/dist/dimple.v2.0.0.min.js"></script>
  <style>
  /* format the title */
    h2 {
      text-align: center;
      color: DarkSlateBlue;
      font: 30px Georgia, sans-serif;
    }
    h5 {
        text-align: center;
        color: DarkSlateBlue;
        font: 15px Georgia, sans-serif;
    }
    h6 {
      text-align: center;
      color: DarkSlateBlue;
      font: 15px Georgia, sans-serif;
    }
  </style>
    <script type="text/javascript">
      function draw(data) {
        /* Create a visualization that shows differences
        among the performance of the baseball players.

        d3 setup code
        */
          // loop through each datapoint
          data.forEach(function(d) {
            // create new feature HRsqrt
              d["HRsqrt"] = Math.sqrt(+d.HR);
          });

        "use strict";
        var margin = 25,
          width = 1800 - margin,
          height = 900 - margin;

        d3.select("body")
          .append("h2")
          .text("Batting Average and HRs by Height and Handedness")
          .append("h5")
          .text("Notice three relatively larger bubbles: \
          L handers at 67 inches, B handers at 76 inches, \
          and R handers at 78 inches.")
          .append("h6")
          .text("In the data set, there are only \
          two L handers at 67 inches. There is only one B hander at 76 inches. \
          There is only one R hander at 78 inches.");

        var svg = d3.select("body")
          .append("svg")
            .attr("width", width + margin)
            .attr("height", height + margin)
          .append('g')
              .attr('class','chart');

        /*
          Dimple.js construction code
        */

        var chart = new dimple.chart(svg, data);
        var chart_x = chart.addCategoryAxis("x", "height");
        chart_x.title = "Height";

        /* add gridlines for visibility */
        chart_x.showGridlines = true;
        var chart_y = chart.addMeasureAxis("y", "avg");
        chart_y.title = "Batting Average";

        /* space the y-axis tickmarks */
        chart_y.tickFormat = ".3f"

        var chart_z = chart.addMeasureAxis("z", "HRsqrt");
        var bubble = chart.addSeries("handedness",  dimple.plot.bubble);

        /* add a trendline on top of the bubbles */
        var line = chart.addSeries("handedness", dimple.plot.line);

        /* take the mean of batting average for each height */
        bubble.aggregate = dimple.aggregateMethod.avg;
        line.aggregate = dimple.aggregateMethod.avg;

        /* set order for handedness for every height */
        bubble.addOrderRule(['L','R','B'], false);
        chart.addLegend(100, 10, 1100, 20, "right");
        chart.draw();

        // access tool tip so that when you hover,
        // total HRs is shown instead of sqrtHR
        bubble.getTooltipText = function(e) {
            console.log(e);
          return ["height: " + e.x, "avg: " + e.y, "HR: "
          + Math.round( e.cz*e.cz )];
            };

      };
    </script>
  </head>
<body>
  <script type="text/javascript">
/*
  Use D3 (not dimple.js) to load the TSV file
  and pass the contents of it to the draw function
  */
  d3.csv("baseball_data_edited.csv", draw);


  </script>
</body>
</html>
